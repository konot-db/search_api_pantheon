<?php

/**
 * @file
 * Contains search_api_pantheon.module..
 */

use Drupal\Core\Routing\RouteMatchInterface;
use Drupal\Core\Form\FormStateInterface;
/**
 * Implements hook_help().
 */
function search_api_pantheon_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the search_api_pantheon module.
    case 'help.page.search_api_pantheon':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Search API + Solr + Pantheon integration') . '</p>';
      return $output;

    default:
  }
}

/**
 * Implements hook_form_alter() on behalf of search_api_pantheon.module.
 */
function search_api_pantheon_form_alter(&$form, FormStateInterface $form_state, $form_id) {
    // Change form id here
  if ($form_id == 'search_api_server_form' && !empty($_ENV['PANTHEON_ENVIRONMENT'])) {
   $form['backend_config']['scheme']['#default_value'] = 'https';
   $form['backend_config']['host']['#default_value'] = pantheon_variable_get('pantheon_index_host');
   $form['backend_config']['port']['#default_value'] = pantheon_variable_get('pantheon_index_port');
   $form['backend_config']['path']['#default_value'] = '/sites/self/environments/' . $_ENV['PANTHEON_ENVIRONMENT'] . '/index';
  }
}

/**
 * Implements hook_search_api_backend_info_alter().
 */
function search_api_pantheon_search_api_backend_info_alter(array &$backend_info) {
  // Completely unsetting search_api_solr as a plugin may be overly aggressive.
  // Consider replacing it with the class provided by this module. Or keep the
  // plugin and add more direction to the UI.
  if (!empty($backend_info['search_api_solr'])) {
    unset($backend_info['search_api_solr']);
  }
}
